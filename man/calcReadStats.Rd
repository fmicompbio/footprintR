% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/calcReadStats.R
\name{calcReadStats}
\alias{calcReadStats}
\alias{addReadStats}
\title{Calculate or add summary statistics for read-level base modification data}
\usage{
calcReadStats(
  se,
  assay.type = "mod_prob",
  stats = NULL,
  regions = NULL,
  sequence.context = NULL,
  min.Nobs.ppos = 0,
  min.Nobs.pread = 0,
  LowConf = 0.7,
  LagRange = c(12, 64),
  verbose = FALSE
)

addReadStats(se, ..., name = "QC")
}
\arguments{
\item{se}{A \code{\link[SummarizedExperiment]{RangedSummarizedExperiment}}
object with assay \code{assay.type} typically returned by
\code{\link{readModkitExtract}} or \code{\link{readModBam}}.}

\item{assay.type}{A character scalar specifying the assay of \code{se}
containing the read-level data to be summarized. Typically, this assay
contains modification probabilities.}

\item{stats}{Character vector specifying which statistics to calculate.
When set to \code{NULL} all available statistics are calculated. See
details for available read statistics.}

\item{regions}{A \code{\link[GenomicRanges]{GRanges}} object limiting the
positions included in the calculations to the ones overlapping the
corresponding genomic regions. Alternatively, regions can be
specified as a character vector (e.g. "chr1:1200-1300") that can be
coerced into a \code{GRanges} object.}

\item{sequence.context}{A character vector with sequence context(s)
to include in the calculations. Only positions that match one of the
provided sequence contexts will be included. Sequence contexts can be
provided using IUPAC redundancy codes. The sequence contexts of modified
bases are obtained from \code{rowData(se)$sequence.context} and thus
requires that \code{se} contains the appropriate information, for example
by setting the \code{sequence.context} and \code{sequence.reference}
arguments of \code{\link{readModkitExtract}} when it was generated,
or by adding it using \code{\link{addSeqContext}}.}

\item{min.Nobs.ppos}{A numeric scalar value >=1 indicating the minimum
coverage on individual positions for them to be included in the
calculations. In high coverage data this is an effective filter for
removing spurious modbases, typically the result of erroneous
basecalling. The default \code{NULL} sets its value to Q3-0.5*IQR, where
Q3 and IQR are the third quartile and interquartile range of the coverage
distribution estimated from the data in \code{se}.}

\item{min.Nobs.pread}{A numeric scalar with the minimum number of observed
modifiable bases per read for it to be included in the calculations.
\code{NA} values are returned for the reads that do not pass this
threshold.}

\item{LowConf}{A numeric scalar with the minimum call confidence below which
calls are considered "low confidence".}

\item{LagRange}{A numeric vector of two values (minimum and maxium) defining
the range of lags for the calculation of autocorrelation and partial
autocorrelation (see details section).}

\item{verbose}{If \code{TRUE}, report on progress.}

\item{...}{For \code{addReadStats} only: Additional arguments passed on to
\code{calcReadStats}.}

\item{name}{For \code{addReadStats} only: A character scalar specifying the
name to be used to store the result in the
\code{\link[SummarizedExperiment]{colData}} of the output.}
}
\value{
For \code{calcReadStats}, a \code{SimpleList} object with summary statistics
for the samples (columns) in \code{se}.

For \code{addReadStats}, a \code{\link[SummarizedExperiment]{SummarizedExperiment}}
object with summary statistics added to the \code{name} column of
\code{\link[SummarizedExperiment]{colData}}.
}
\description{
\code{calcReadStats} calculates various per-read summary statistics on
modification probabilities or calls from a
\code{\link[SummarizedExperiment]{SummarizedExperiment}} object with genomic
positions in rows and samples in columns. \code{addReadStats} adds them to
the \code{colData} under \code{name}. See details for more information on the
statistics that are calculated.
}
\details{
\code{calcReadStats} calculates a collection of location/scatter statistics
and information theoretic/signal-processing metrics for the modification
probability, confidence or modification call value vectors across individual
reads (data in assay \code{assay.type}). Only bases matching the criteria
given by\code{regions}, \code{sequence.context}, \code{min.Nobs.ppos} and
\code{min.Nobs.pread} are included in the calculations. The values of these
filtering parameters are stored in the attribute of the output.

\code{stats} selects the summaries to be calculated. Currently available
values are:
\describe{
\item{MeanModProb}{: Mean modification probability across the read.}
\item{FracMod}{: Fraction of confidently modified bases, defined as the
ratio of modifiable bases with modification probability >= 0.5 over
all modifiable bases.}
\item{MeanConf}{:  Mean call confidence across the read.}
\item{MeanConfUnm}{: Mean call confidence confined to unmodified bases
(modifiable bases with modification probability < 0.5).}
\item{MeanConfMod}{: Mean call confidence confined to modified bases
(modifiable bases with modification probability >= 0.5).}
\item{FracLowConf}{: Fraction of modifiable bases called with low
confidence (call confidence < \code{LowConf}).}
\item{IQRModProb}{: Interquartile range of modification probabilities
across the read.}
\item{sdModProb}{: Standard deviation of modification probabilities
across the read.}
\item{SEntrModProb}{: Sample entropy of the modification probability
signal. Sample entropy is a metric assessing the complexity of
one-dimensional physiological signals. The higher the sample entropy,
the more irregular, unpredictable and therefore complex the signal.
See \href{https://en.wikipedia.org/wiki/Sample_entropy}{wikipedia:Sample_entropy}
for more details.}
\item{Lag1DModProb}{: Mean Lag1 differences of modification calls,
defined as: \code{mean(Mod[i]-Mod[i-1])}, where \code{Mod} is a
\code{{0,1}} modification call.}
\item{ACModProb}{: Autocorrelation of the modification probability values
for lags in the range \code{LagRange}. This range typically covers
the signal of nucleosome periodicity.}
\item{PACModProb}{: Partial autocorrelation of the modification
probability values for lags in the range \code{LagRange}. This range
typically covers the signal of nucleosome periodicity.}
}
}
\examples{
# load example data
library(SummarizedExperiment)
modbamfile <- system.file("extdata", "6mA_1_10reads.bam",
                          package = "footprintR")
se <- readModBam(bamfile = modbamfile, regions = "chr1:6940000-6955000",
           modbase = "a", verbose = TRUE)

readStats <- calcReadStats(se)
readStats$s1

se_withReadStats <- addReadStats(se, name = "QC")
se_withReadStats$QC$s1
metadata(se_withReadStats$QC$s1)

}
\author{
Panagiotis Papapasaikas, Charlotte Soneson, Michael Stadler
}
